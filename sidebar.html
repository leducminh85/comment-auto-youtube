<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --neon-cyan: #00ffff;
      --neon-purple: #bb86fc;
      --bg-dark: #0a0a0a;
      --card-bg: #1e1e1e;
      --text: #e0e0e0;
      --disabled: #555;
    }
    body {
      width: 300px;
      padding: 15px;
      font-family: 'Roboto', sans-serif;
      background: linear-gradient(135deg, var(--bg-dark), #1a1a1a);
      color: var(--text);
      margin: 0;
    }
    h3 {
      color: var(--neon-cyan);
      text-shadow: 0 0 8px rgba(0, 255, 255, 0.6);
      margin: 0 0 15px;
      font-size: 18px;
    }

    /* === COLLAPSIBLE API KEY === */
    .collapsible {
      cursor: pointer;
      padding: 10px;
      background: var(--card-bg);
      border-radius: 8px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: 0.3s;
      box-shadow: 0 0 5px rgba(0, 255, 255, 0.2);
    }
    .collapsible:hover { box-shadow: 0 0 10px rgba(0, 255, 255, 0.5); }
    .collapsible .arrow {
      transition: transform 0.3s;
    }
    .collapsible.open .arrow { transform: rotate(90deg); }
    .collapse-content {
      display: none;
      padding: 10px;
      background: #2c2c2c;
      border-radius: 8px;
      margin-top: 8px;
      border: 1px solid var(--neon-cyan);
    }
    .collapse-content input {
      background: #333;
      border: 1px solid var(--neon-purple);
      color: var(--text);
      padding: 8px;
      border-radius: 6px;
      width: 100%;
      margin-bottom: 8px;
    }

    /* === MODE TOGGLE SWITCH === */
    .mode-toggle {
      display: flex;
      background: #2c2c2c;
      border-radius: 8px;
      overflow: hidden;
      margin: 12px 0;
      border: 1px solid var(--neon-cyan);
    }
    .mode-btn {
      flex: 1;
      padding: 10px;
      text-align: center;
      font-weight: 500;
      cursor: pointer;
      transition: 0.3s;
      position: relative;
    }
    .mode-btn.active {
      background: linear-gradient(135deg, var(--neon-cyan), var(--neon-purple));
      color: #000;
      font-weight: 700;
      box-shadow: 0 0 10px rgba(0, 255, 255, 0.7);
    }

    /* === BUTTONS === */
    button {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border: none;
      border-radius: 8px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      background: linear-gradient(135deg, var(--neon-cyan), var(--neon-purple));
      color: #000;
    }
    button:hover:not(:disabled) {
      transform: scale(1.05);
      box-shadow: 0 0 15px rgba(0, 255, 255, 0.8);
    }
    button:disabled {
      background: var(--disabled);
      cursor: not-allowed;
      transform: none;
    }

    /* === STATUS + SPINNER === */
    #status {
      text-align: center;
      font-weight: 500;
      color: #00ff00;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 10px 0;
    }
    .spinner {
      display: none;
      width: 16px; height: 16px;
      border: 3px solid rgba(0, 255, 255, 0.3);
      border-top: 3px solid var(--neon-cyan);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-left: 8px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .loading .spinner { display: inline-block; }

    /* === PREVIEW REPLY - NỔI BẬT === */
    .preview {
      background: linear-gradient(135deg, #1a1a2e, #16213e);
      padding: 12px;
      border-radius: 10px;
      border: 2px solid var(--neon-purple);
      box-shadow: 0 0 15px rgba(187, 134, 252, 0.6);
      margin: 12px 0;
      display: none;
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0%, 100% { box-shadow: 0 0 15px rgba(187, 134, 252, 0.6); }
      50% { box-shadow: 0 0 25px rgba(0, 255, 255, 0.8); }
    }
    .preview strong {
      color: var(--neon-cyan);
      display: block;
      margin-bottom: 8px;
      font-size: 14px;
    }
    #replyText {
      color: #fff;
      font-weight: 500;
      background: #0f0f1e;
      padding: 10px;
      border-radius: 6px;
      margin-bottom: 10px;
      min-height: 50px;
      font-size: 13px;
      line-height: 1.5;
    }
    .preview button {
      width: 48%;
      margin: 3px 1%;
      font-size: 13px;
    }

    /* === LOG === */
    #logContainer {
      margin-top: 15px;
    }
    #logBox {
      height: 130px;
      overflow-y: auto;
      background: #0a0a0a;
      color: #00ff00;
      padding: 10px;
      border-radius: 8px;
      font-family: monospace;
      font-size: 11.5px;
      border: 1px solid var(--neon-cyan);
      white-space: pre-line;
    }

    /* === PROMPT EDITOR === */
    .prompt-editor {
      margin-top: 15px;
      padding: 10px;
      background: var(--card-bg);
      border-radius: 8px;
      border: 1px solid var(--neon-cyan);
    }
    .prompt-editor textarea {
      width: 100%;
      height: 90px;
      background: #2c2c2c;
      border: 1px solid var(--neon-purple);
      color: var(--text);
      padding: 8px;
      border-radius: 6px;
      resize: none;
      font-size: 12px;
    }

    /* === DISABLED STATE === */
    .processing * {
      pointer-events: none !important;
      opacity: 0.6;
    }
    .processing .preview,
    .processing #status,
    .processing button#apply,
    .processing button#cancel {
      pointer-events: auto !important;
      opacity: 1;
    }
  </style>
</head>
<body>

  <h3>Auto Reply Gemini</h3>

  <!-- 1. COLLAPSIBLE API KEY -->
  <div class="collapsible" id="apiKeyToggle">
    <span>API Key (Gemini)</span>
    <span class="arrow">></span>
  </div>
  <div class="collapse-content" id="apiKeyContent">
    <input type="password" id="apiKey" placeholder="Nhập API Key...">
    <button id="saveKey">Lưu Key</button>
  </div>

  <!-- 2. MODE TOGGLE SWITCH -->
  <div class="mode-toggle">
    <div class="mode-btn active" data-mode="continuous">Continuous</div>
    <div class="mode-btn" data-mode="manual">Manual</div>
  </div>

  <!-- 3. START / STOP -->
  <button id="start">Start</button>
  <button id="stop" disabled>Stop</button>

  <div id="status">Ready <div class="spinner"></div></div>

  <!-- PREVIEW REPLY - NỔI BẬT -->
  <div id="preview" class="preview">
    <strong>Preview Reply:</strong>
    <div id="replyText"></div>
    <button id="apply">Reply</button>
    <button id="cancel">Cancel</button>
  </div>

  <!-- LOG -->
  <div id="logContainer">
    <strong>Log:</strong>
    <div id="logBox"></div>
    <button id="clearLog">Clear Log</button>
  </div>

  <!-- PROMPT EDITOR -->
  <div class="prompt-editor">
    <label>Prompt cho Gemini:</label>
    <textarea id="customPrompt" placeholder="Nhập prompt..."></textarea>
    <div style="display:flex; gap:5px; margin-top:8px;">
      <button id="savePrompt" style="flex:1;">Lưu</button>
      <button id="resetPrompt" style="flex:1;">Mặc định</button>
    </div>
    <small id="promptStatus" style="color:#00ffff; margin-top:5px; display:block;"></small>
  </div>

  <script src="sidebar.js"></script>
</body>
</html>